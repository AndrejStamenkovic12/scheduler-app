{% extends "base.html" %}

{% block title %}Leave a Review - Appointment Scheduler{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0">
                    <i class="fas fa-star me-2"></i>
                    Leave a Review
                    {% if current_user.id == appointment.user_id %}
                        - Review Provider
                    {% elif current_user.id == appointment.provider_id %}
                        - Review Customer
                    {% endif %}
                </h4>
            </div>
            <div class="card-body">
                <!-- Appointment Details -->
                <div class="card bg-light mb-4">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-calendar-check me-2"></i>
                            Appointment Details
                        </h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Service:</strong> {{ appointment.type }}</p>
                                <p><strong>Date:</strong> {{ appointment.datetime.strftime('%B %d, %Y') }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Time:</strong> {{ appointment.datetime.strftime('%I:%M %p') }}</p>
                                <p><strong>Duration:</strong> {{ appointment.duration }} minutes</p>
                            </div>
                        </div>
                        {% if appointment.notes %}
                            <p><strong>Notes:</strong> {{ appointment.notes }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Review Form -->
                <form method="POST">
                    <div class="mb-4">
                        <label for="rating" class="form-label">
                            <strong>Rating *</strong>
                        </label>
                        <div class="rating-input">
                            <div class="star-rating">
                                <input type="radio" id="star5" name="rating" value="5" required>
                                <label for="star5" class="star" title="Excellent">
                                    <i class="fas fa-star"></i>
                                </label>
                                <input type="radio" id="star4" name="rating" value="4">
                                <label for="star4" class="star" title="Very Good">
                                    <i class="fas fa-star"></i>
                                </label>
                                <input type="radio" id="star3" name="rating" value="3">
                                <label for="star3" class="star" title="Good">
                                    <i class="fas fa-star"></i>
                                </label>
                                <input type="radio" id="star2" name="rating" value="2">
                                <label for="star2" class="star" title="Fair">
                                    <i class="fas fa-star"></i>
                                </label>
                                <input type="radio" id="star1" name="rating" value="1">
                                <label for="star1" class="star" title="Poor">
                                    <i class="fas fa-star"></i>
                                </label>
                            </div>
                            <div class="rating-labels mt-2">
                                <small class="text-muted">Click on a star to rate (1-5 stars)</small>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="comment" class="form-label">
                            <strong>Comment (Optional)</strong>
                        </label>
                        <textarea class="form-control" id="comment" name="comment" rows="4" 
                                  placeholder="Share your experience with this service..."></textarea>
                        <div class="form-text">
                            Your feedback helps improve our services and helps other customers make informed decisions.
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        {% if current_user.role == 'provider' %}
                            <a href="{{ url_for('provider_appointments') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>
                                Back to Appointments
                            </a>
                        {% else %}
                            <a href="{{ url_for('history') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>
                                Back to History
                            </a>
                        {% endif %}
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-star me-1"></i>
                            Submit Review
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.star-rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
    gap: 5px;
}

.star-rating input[type="radio"] {
    display: none;
}

.star-rating label {
    font-size: 2rem;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s;
}

.star-rating label:hover,
.star-rating label:hover ~ label,
.star-rating input[type="radio"]:checked ~ label {
    color: #ffc107;
}

.rating-input {
    margin-bottom: 1rem;
}

.rating-labels {
    text-align: center;
}
</style>

<script>
// Add visual feedback for star selection
document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.star-rating input[type="radio"]');
    const labels = document.querySelectorAll('.star-rating label');
    
    stars.forEach((star, index) => {
        star.addEventListener('change', function() {
            // Remove all active classes
            labels.forEach(label => label.classList.remove('active'));
            
            // Add active class to selected star and all stars before it
            for (let i = 0; i <= index; i++) {
                labels[i].classList.add('active');
            }
        });
    });
});
</script>
{% endblock %}
